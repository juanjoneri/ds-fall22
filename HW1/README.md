# Assignment

The goal of this assignment is to learn client server programming with TCP and UDP sockets. You are required to implement a server and a client for an online store system. 

The system should function with both TCP as well as UDP connections. The server has an input file which represents all products of the store. There is a single server, but multiple clients may access the server concurrently. 

The server must be multithreaded. Assume that a person can purchase only one type of product at any given time. 

Every client accepts only the following commands from standard input:

a. `setmode T|U` – sets the protocol for communication with the server. The protocol is specified by the letter U ot T where U stands for UDP and T stands for TCP. The default mode of communication is TCP.

b. `purchase <user-name> <product-name> <quantity>` – inputs the name of a customer, the name of the product, and the number of quantity that the user wants to purchase. The client sends this command to the server using the current mode of the appropriate protocol. If the store does not have enough items, the server responds with message: `Not Available - Not enough items`. If the store does not have the product, the server responds with message: `Not Available - We do not sell this product`. Otherwise, an order is placed and the server replies a message: `You order has been placed, <order-id> <user-name> <product-name> <quantity>`. Note that, the order-id is unique and automatically generated by the server. You can assume that the order-id starts with 1. The server should also update the inventory.

c. `cancel <order-id>` – cancels the order with the <order-id>. If there is no existing order with the id, the response is: `<order-id> not found, no such order`. Otherwise, the server replies: `Order <order-id> is canceled` and updates the inventory.

d. `search <user-name>` – returns all orders for the user. If no order is found for the user, the system responds with a message: `No order found for <user-name>`. Otherwise, list all orders of the users as `<order-id>, <product-name>, <quantity>`. Note that, you should print one line per order.

e. `list` – lists all available products with quantities of the store. For each product, you should show `<product-name> <quantity>`. Note that, even if the product is sold out, you should also print the product with quantity 0. In addition, you should print one line per product. The products should be listed in the sorted order.

## Solution

### Server

1. The entry point for the server is the `ServerRunner` class (can be run with the script `sh start_server.sh`). It requires 2 command line arguments: 1. a port number where the server will listen for new clients, 2. a relative path to the inventory path. ServerRunner reads those inputs, initializes a thread-safe `Inventory` class used to keep track of transactions, and starts a new thread `Server`.

2. The `Server` class is a simple process that listens for messages with the pattern `connect <tcpPort> <udpPort>` on the port specified above. Once a new client issues that command, `Server` will start two new threads to handle TCP and UDP requests for that client.

3. `TcpServerHandler` and `UdpServerHandler` are threads intended to handle the TCP and UDP requests respectively from a given client. Each time they get a request that matches one of the expected commands (`list`, `purchase`, etc) they update the `Inventory` accordingly.

### Client

1. The entry point for the client is the `ClientRunner` class (can be run with the script `sh start_client.sh`). It requires 4 command line arguments: 1. The hostname where to find the server, 2. the port number for the server (i.e. the second argument to ServerRunner), 3. the port number this client will use for TCP communication, 4. the port number this client will use for UDP communication.

2. `ClientRunner` is a single-threaded application, it continuously reads from stdin and:
  - if the input is `setmode U` it prompts the `Client` to switch the mode of subsequent communication to UDP
  - if the input is `setmode T` it prompts the `Client` to switch the mode of subsequent communication to TCP
  - else it calls `Client.send` which will send a TCP or UDP request to the server depending on the current mode that is set (TCP by default).